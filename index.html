<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>WebRTC Extensions</title>
  <script src="https://www.w3.org/Tools/respec/respec-w3c-common" class="remove"></script>
  <script class='remove'>
  "use strict";
  // See https://github.com/w3c/respec/wiki/ for how to configure ReSpec
  var respecConfig = {
    "doRDFa": false,
    "format": "markdown",
    // "githubAPI": "https://api.github.com/repos/WICG/webrtc-extensions",
    // "issueBase": "https://www.github.com/WICG/webrtc-extensions/issues/",
    "noLegacyStyle": true,
    "editors": [{
        name: "Henrik Bostr√∂m",
        email: "hbos@google.com",
        company: "Google Inc.",
      }
      // Add additional editors here.
      // https://github.com/w3c/respec/wiki/editors
    ],
    "shortName": "webrtc-extensions",
    "specStatus": "CG-DRAFT",
    "subjectPrefix": "[webrtc-extensions]",
    // "wg": "WICG",
    "otherLinks": [{
      "key": "Repository",
      "data": [{
        "value": "We are on Github.",
        "href": "https://github.com/henbos/webrtc-extensions"
      }, {
        "value": "File a bug.",
        "href": "https://github.com/henbos/webrtc-extensions/issues"
      }, {
        "value": "Commit history.",
        "href": "https://github.com/henbos/webrtc-extensions/commits/master"
      }, ]
    }],
  };
  </script>
</head>

<body>
  <section id="abstract">
    <p>
      TODO(henbos): Fill in.
    </p>
  </section>
  <section id="sotd">
    <p>
      This is an unofficial proposal.
    </p>
  </section>
  <section id="introduction">
    <h2>Introduction</h2>
    <p>
      TODO(henbos): Fill in.
    </p>
  </section>
  <section>
    <h2>Terminology</h2>
    <p>The term <dfn data-cite="!WEBRTC#dom-rtciceserver">RTCIceServer</dfn> is
    defined in [[WEBRTC]].</p>
    <p>When referring to exceptions, the terms <dfn
      data-cite="!WEBIDL#dfn-throw">throw</dfn> and
      <dfn data-dfn-for="exception" data-cite=
      "!WEBIDL#dfn-create-exception">create</dfn> are
      defined in [[WEBIDL]].</p>
  </section>
  <section id="rtcpeerconnection-interface">
    <h3>
      <dfn>RTCPeerConnection</dfn> extensions
    </h3>
    <p>
      The <code><a href="https://w3c.github.io/webrtc-pc/#interface-definition">RTCPeerConnection</a></code>
      interface is defined in [[WEBRTC]]. This document extends that interface
      by adding an additional static method.
    </p>
    <pre class="idl">partial interface RTCPeerConnection {
  static sequence&lt;RTCIceServer&gt; getDefaultIceServers();
};</pre>
    <section>
      <h2>Methods</h2>
      <dl data-link-for="RTCPeerConnection" data-dfn-for=
      "RTCPeerConnection" class="methods">
        <dfn data-idl><code>getDefaultIceServers</code></dfn></dt>
        <dd>
          <p>Returns a list of ICE servers that are configured into the
          browser. A browser might be configured to use local or private
          STUN or TURN servers. This method allows an application to learn
          about these servers and optionally use them.</p>
          <p class="fingerprint">This list is likely to be persistent and
          is the same across origins. It thus increases the
          fingerprinting surface of the browser. In privacy-sensitive
          contexts, browsers can consider mitigations such as only
          providing this data to whitelisted origins (or not providing it
          at all.)</p>
          <p class="note">Since the use of this information is left to
          the discretion of application developers, configuring a user
          agent with these defaults does not per se increase a user's
          ability to limit the exposure of their IP addresses.</p>
          <p class="note">If set, the configured default ICE servers exposed by
          <a data-link-for="RTCPeerConnection">getDefaultIceServers</a> on
          <code><a>RTCPeerConnection</a></code> instances provides persistent
          information across time and origins which increases the fingerprinting
          surface of a given browser.</p>
          <div class="issue atrisk">
            <p><code>getDefaultIceServers()</code> was moved from [[WEBRTC]] to
            this extension spec due to lack of support from implementers and
            concerns discussed in <a href="https://github.com/w3c/webrtc-pc/issues/2023">webrtc-pc#2023</a>.</p>
          </div>
        </dd>
      </dl>
    </section>
  </section>
  <section id="rtcrtpreceiver-interface">
    <h3>
      <dfn>RTCRtpReceiver</dfn> extensions
    </h3>
    <p>
      The <code><a href="https://w3c.github.io/webrtc-pc/#dom-rtcrtpreceiver">RTCRtpReceiver</a></code>
      interface is defined in [[WEBRTC]]. This document extends that interface
      by adding an additional internal slot and attribute.
    </p>
    <p>
      Let <code>RTCRtpReceiver</code> objects have a
      <dfn>[[\PlayoutDelayHint]]</dfn> internal slot initially
      initialized to <code>null</code>.
    </p>
    <pre class="idl">partial interface RTCRtpReceiver {
  attribute double? playoutDelayHint;
  };</pre>
    <section>
      <h2>Attributes</h2>
      <dl data-link-for="RTCRtpReceiver" data-dfn-for="RTCRtpReceiver"
      class="attributes">
        <dt><dfn><code>playoutDelayHint</code></dfn> of type <span
          class="idlAttrType">double</span>, nullable</dt>
        <dd>
          <p>This attribute allows the application to give a hint to the User
          Agent about what playout delay is acceptable. The User Agent SHOULD
          NOT playout audio or video that is received unless this amount of time
          has passed in seconds, allowing the User Agent to perform more or less
          buffering than it might otherwise do. This allows to influence the
          tradeoffs between having a higher delay and the risk that buffers such
          as the jitter buffer will run out of audio or video frames to play due
          to network jitter. This API only serves to provide a hint, and the
          User Agent may ignore it. The hint SHOULD NOT be followed if it
          significantly impacts audio or video quality (e.g. bad network), or if
          the value implies allocating larger buffers than the User Agent is
          willing to provide.</p>
          <p class="note">
            The playout delay hint applies even if DTX is used. For example, if
            DTX is used and packets start flowing after silence, the hint can
            influence the User Agent to buffer these packets rather than playing
            them out.
          </p>
          <p class="note">
            If the track is paired with other tracks through
            <code><a>RTCRtpReceiver</a></code>
            <a href="https://w3c.github.io/webrtc-pc/#dfn-associatedremotemediastreams">
            [[\AssociatedRemoteMediaStreams]]</a> internal slot, then it will
            be synchronized with other tracks (for e.g. audio video
            synchronization). This means that even if one of the paired tracks
            is delayed through [[\PlayoutDelayHint]] then the User Agent
            synchronization mechanism will automatically delay all others
            paired tracks. If multiple such paired tracks are delayed through
            <a>[[\PlayoutDelayHint]]</a> by different amounts then the largest
            of those hints will take precedence in synchronization mechanism.
          </p>
          <p>On getting, this attribute MUST return the value of the
          <a>[[\PlayoutDelayHint]]</a> internal slot.</p>
          <p>On setting, the User Agent MUST run the following steps:</p>
          <ol>
            <li>
              <p>Let <var>receiver</var> be the
              <code><a>RTCRtpReceiver</a></code> object on which the setter is
              invoked.</p>
            </li>
            <li>
              <p>Let <var>delay</var> be the argument to the setter.</p>
            </li>
            <li>
              <p>If <var>delay</var> is negative, <a>throw</a> an
              <code>TypeError</code> and abort these steps.</p>
            </li>
            <li>
              <p>Set the value of <var>receiver</var>'s
              <a>[[\PlayoutDelayHint]]</a> internal slot to
              <var>delay</var>.</p>
            </li>
            <li>
              <p>In parallel, begin executing the following steps:</p>
              <ol>
                <li>
                  <p>Update the underlying system about the new delay hint, or
                  that there is no hint if <var>delay</var> is
                  <code>null</code>. If at any point in time this value is
                  larger than the User Agent is able or willing to provide, the
                  User Agent SHOULD use the maximum value available to match the
                  requested delay as close as possible. If at any point in time
                  this value is smaller than the User Agent determines is needed
                  in order provide sufficient audio or video quality, the User
                  Agent SHOULD use the smallest value possible.</p>
                  <p class="note">
                    If User Agent ignores the hint at any time, this is not
                    reflected in the <a>[[\PlayoutDelayHint]]</a> internal slot.
                  </p>
                </li>
              </ol>
            </li>
          </ol>
        </dd>
      </dl>
    </section>
  </section>
  <section id="rtcrtpencodingparameters-interface">
    <h3>
      <dfn>RTCRtpEncodingParameters</dfn> extensions
    </h3>
    <p>
      The <code><a href="https://w3c.github.io/webrtc-pc/#rtcrtpencodingparameters">RTCRtpEncodingParameters</a></code>
      dictionary is defined in [[WEBRTC]]. This document extends that dictionary
      by adding an additional boolean flag.
    </p>
    <pre class="idl">partial dictionary RTCRtpEncodingParameters {
      boolean adaptivePtime = false;
    };</pre>
    <h2>Dictionary <code><a>RTCRtpEncodingParameters</a></code> Members</h2>
    <dl data-link-for="RTCRtpEncodingParameters" data-dfn-for="RTCRtpEncodingParameters" class="dictionary-members">
      <dt><dfn data-idl><code>adaptivePtime</code></dfn> of type <span class="idlMemberType">boolean</span>, defaulting to <code>false</code>.</dt>
      <dd>
        <p>Indicates whether this encoding MAY dynamically change
        the frame length. If the value is <code>true</code>,
        the user agent MAY use any valid frame length for any of its
        frames, and MAY change this at any time. Valid values are multiples
        of 10ms. If the <code>maxptime</code> attribute (defined in
        [[RFC4566]] Section 6) is specified, that maximum applies.
        <a href="https://w3c.github.io/webrtc-pc/#dfn-read-only-parameter">Read-only parameter.</a></p>
        <p class="note">Using a longer frame length reduces the
        bandwidth consumption due to overhead, but does so at the cost
        of increased latency. Changing the frame length dynamically allows the
        user agent to adapt its bandwidth allocation strategy based on the
        current network conditions.</p>
        <p>If <code>adaptivePtime</code> is set to <code>true</code>,
        <code>ptime</code> MUST NOT be set; otherwise,
        <code>InvalidModificationError</code> MUST be thrown.</p>
      </dd>
    </dl>
  </section>
</body>
</html>
